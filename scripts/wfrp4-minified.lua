function a(z,A)if(z == A and true)then return true else return false end end function b(z,A)if z == 0 and A == 0 then return 100 else return z * 10+A end end c=true d=1 e=97 f=true g=true function h(z,A)if(z <= A or (c and z <= d))and not (c and z >= e)then return true else return false end end function i(z,A)if z >= A or z >= e then return true else return false end end function j(z,A,B)if(f and a(A, B))or((z ~= "corps-a-corps" or z ~= "distance") and c and (b(A, B) <= d or b(A, B) >= e))then return true else return false end end function k(z)z= tostring(z)or"I"if z=="TF"then return 60 elseif z=="F"then return 40 elseif z=="A"then return 20 elseif z=="I"then return 0 elseif z=="C"then return-10 elseif z=="D"then return-20 elseif z=="TD"then return-30 end end function l(z)z=string.lower(z)if z == "tf"or z == "tresfacile"then return"TF"elseif z == "f"or z == "facile"then return"F"elseif z == "a"or z == "accessible"then return"A"elseif z == "i" or z == "intermediaire"or z == "intermédiaire"then return"I"elseif z == "c"or z == "complexe"then return"C"elseif z == "d"or z == "difficile"then return"D"elseif z == "td"or z == "tresdifficile"then return"TD"end end function m(z)z=string.lower(z)if z == "tf"or z == "tresfacile"then return"Très Facile"elseif z == "f"or z == "facile"then return"Facile"elseif z == "a"or z == "accessible"then return"Accessible"elseif z == "i" or z == "intermediaire"or z == "intermédiaire"then return"Intermédiaire"elseif z == "c"or z == "complexe"then return"Complexe"elseif z == "d"or z == "difficile"then return"Difficile"elseif z == "td"or z == "tresdifficile"then return"Très Difficile"end end function n(z)z=string.lower(z)if z == "tf"or z == "tresfacile"then return"+60"elseif z == "f"or z == "facile"then return"+40"elseif z == "a"or z == "accessible"then return"+20"elseif z == "i" or z == "intermediaire"or z == "intermédiaire"then return"0"elseif z == "c"or z == "complexe"then return"-10"elseif z == "d"or z == "difficile"then return"-20"elseif z == "td"or z == "tresdifficile"then return"-30"end end function o(z)z=tonumber(z)if z<=0 then return"+0"elseif z>0 then return"+"..z * 10 end end function p(z,A)local B= z+A if(B < 1 and true)then B=1 end return B end function q(z,A)local B= (A - z)/10 local C=0 if(B > 0 and true)then C=math.floor(B)elseif(B < 0 and true)then C=math.ceil(B)end C= C+r(A)return C end function r(z)local A=0 if g then if(z > 100 and true)then A=math.floor((z - 100)/10)end else A=0 end return A end function s(z)if(z >= 1 and z <= 9)then return"Tête"elseif(z >= 10 and z <= 24)then return"Bras secondaire"elseif(z >= 25 and z <= 44)then return"Bras principal"elseif(z >= 45 and z <= 79)then return"Corps"elseif(z >= 80 and z <= 89)then return"Jambe gauche"elseif(z >= 90 and z <= 100)then return"Jambe droite"end end function t(z)local A=""if z=="Tête"then A="à la Tête"elseif z=="Bras secondaire"then A="au niveau du Bras gauche (ou du bras secondaire)"elseif z=="Bras principal"then A="au niveau du Bras droit (ou du bras principal)"elseif z=="Corps"then A="au niveau du Corps"elseif z=="Jambe gauche"then A="au niveau de la Jambe gauche"elseif z=="Jambe droite"then A="au niveau de la Jambe droite"end return A end function u(z)if z >= 1 and z <= 20 then return"%s se blesse tout seul en attaquant, et perd un Point de Blessure sans tenir compte du Bonus d'Endurance ou des Points d'Armure."elseif z >= 21 and z <= 40 then return"L'arme de Corps-à-Corps de %s s'ébrèche salement, ou l'arme de tir à distance ne fonctionne pas ou se trouve sur le point de se briser. L'arme subit 1 point de Dégâts. Au prochain Round, %s agira en dernier sans tenir compte de l'ordre d'initiative, des talents ni de toute règle spéciale pendant que le porteur gère la situation."elseif z >= 41 and z <= 60 then return"%s a mal négocié sa manoeuvre, ce qui le met en mauvaise posture. Au cours du prochain round, votre action subira une pénalité de -10."elseif z >= 61 and z <= 70 then return"%s trébuche franchement et peine à se redresser, il perd son prochain Mouvement."elseif z >= 71 and z <= 80 then return"%s ne tient pas son arme correctement ou laisse tomber ses munitions, il perd sa prochaine Action."elseif z >= 81 and z <= 90 then return"%s effectue un mouvement trop ample ou trébuche et se tord la cheville, subissant un traumatisme [i]Déchirure musculaire (Mineure)[/i] comptant comme une Blessure critique."elseif z >= 91 and z <= 100 then return"%s manque complètement son attaque et touche un allié au hasard à distance en utilisant le chiffre des unités du lancer de dés pour déterminer le DR. Si personne n'est à distance, il se blesse tout seul et obtient l'État [i]Sonné[/i]."end end function v(z)local A=rpg.roll.dice(2,0,9)local B=A[1]local C=A[2]local D=b(B,C)local E=""local F=0 local G=""if z=="Tête"then if D >= 1 and D <= 10 then E="Blessure spectaculaire"F=1 G="Une fine entaille qui va du front jusqu'à la joue. +1 État [i]Hémorragique[/i]. Une fois que la blessure est guérie, l'impressionnante cicatrice permet d'obtenir DR+1 à certains tests sociaux."elseif D >= 11 and D <= 20 then E="Coupure mineure"F=1 G="Le coup entaille la joue et le sang dégouline partout. +1 État [i]Hémorragique[/i]."elseif D >= 21 and D <= 25 then E="Coup à l'oeil"F=1 G="Le coup touche à l'orbite de l'oeil. +1 État [i]Aveuglé[/i]."elseif D >= 26 and D <= 30 then E="Frappe à l'oreille"F=1 G="Le coup touche à l'orbite de l'oreille et le personnage touché perçoit un bourdonnement ignoble. +1 État [i]Assourdi[/i]."elseif D >= 31 and D <= 35 then E="Coup percutant"F=2 G="Le sang obsurcit la vision du personnage touché, qui perçoit des points blancs et des flashs de lumière. +1 État [i]Sonné[/i]."elseif D >= 36 and D <= 40 then E="Oeil au beurre noir"F=2 G="C'est un coup massif au niveau des yeux, très douloureux. +2 États [i]Aveuglé[/i]."elseif D >= 41 and D <= 45 then E="Oreille tranchée"F=2 G="C'est un coup très violent sur le côté de la tête, qui entaille profondément l'oreille. +2 États [i]Assourdi[/i] et +1 État [i]Hémorragique[/i]."elseif D >= 46 and D <= 50 then E="En plein front"F=2 G="C'est un coup percutant en plein front. +2 États [i]Hémorragique[/i] et +1 État [i]Aveuglé[/i] qui ne peut être retiré tant que tous les États [i]Hémorragique[/i] n'ont pas été éliminés."elseif D >= 51 and D <= 55 then E="Mâchoire fracturée"F=3 G="Le coup fracture la mâchoire avec un bruit dégoûtant. Les vagues de douleur déferlent instantanément. +2 États [i]Sonné[/i] et subissez le Traumatisme [i]Fracture (Mineure)[/i]."elseif D >= 56 and D <= 60 then E="Blessure majeure à l'oeil"F=3 G="Le coup lézarde l'orbite. +1 État [i]Hémorragique[/i]. +1 État [i]Aveuglé[/i] qui ne pourra être soigné que lorsqu'on vous appliquera Aide Médicale."elseif D >= 61 and D <= 65 then E="Blessure majeure à l'oreille"F=3 G="Le coup endommage votre oreille, causant une perte auditive permanente. Vous subissez une pénalité de -20 à tout Test ayant un rapport avec l'audition. Si vous tombez une seconde fois sur cette blessure, vous perdez totalement l'audition car votre deuxième oreille devient elle aussi silencieuse. Ne peut être guéri que par la magie."elseif D >= 66 and D <= 70 then E="Nez cassé"F=3 G="Un coup violent porté au centre du visage déverse des flots de sang. +2 États [i]Hémorragique[/i]. Réussissez un Test de [b]Résistance Intermédiaire (+0)[/b] ou gagnez l'État [i]Sonné[/i]. Une fois cette blessure guérie, gagnez [b]DR+1/-1[/b] aux Tests Sociaux en fonction du contexte, jusqu'à ce que [b]Chirurgie[/b] soit utilisée sur le nez pour le réparer."elseif D >= 71 and D <= 75 then E="Mâchoire cassée"F=4 G="Le coup brise la mâchoire avec un bruit ignoble. +3 États [i]Sonné[/i]. Réussissez un Test de [b]Résistance Intermédiaire (+0)[/b] ou gagnez l'État [i]Inconscient[/i]. Subissez le Traumatisme [b]Fracture (Majeure)[/b]"elseif D >= 76 and D <= 80 then E="Commotion cérébrale"F=4 G="Le cerveau bouge à l'intérieur de la boîte crânienne, alors que le sang coule à flots du nez et des oreilles. +1 État [i]Assourdi[/i], +2 États [i]Hémorragique[/i] et +1D10 États [i]Sonné[/i]. +1 État [i]Exténué[/i] pour 1D10 jours. Si vous recevez une autre Blessure critique à la tête alors que vous êtes [i]Exténué[/i], réussissez un Test de [b]Résistance Accessible (+20)[/b] ou +1 État [i]Inconscient[/i]."elseif D >= 81 and D <= 85 then E="Bouche explosée"F=4 G="La bouche se remplit de sang et de dents cassées avec un bruit répugnant. +2 États [i]Hémorragique[/i]. Perdez 1D10 dents — [b]Amputation (Facile)[/b]."elseif D >= 86 and D <= 90 then E="Oreille mutilée"F=4 G="Il ne reste plus grand-chose de l'oreille après que le coup l'ait déchiquetée. +3 États [i]Assourdi[/i] et +2 États [i]Hémorragique[/i]. L'oreille est perdue — [b]Amputation (Accessible)[/b]"elseif D >= 91 and D <= 93 then E="Œil crevé"F=5 G="Le coup porté à l'œil le crève, provoquant une douleur quasi-insoutenable. +3 États [i]Aveuglé[/i], +2 États [i]Hémorragique[/i] et +1 États [i]Sonné[/i]. L'œil est perdu — [b]Amputation (Complexe)[/b]"elseif D >= 94 and D <= 96 then E="Coup défigurant"F=5 G="Le coup explose le visage, crevant un œil et brisant le nez. +3 États [i]Hémorragique[/i], +3 États [i]Aveuglé[/i] et +2 États [i]Sonné[/i]. L'œil et le nez sont perdus — [b]Amputation (Difficile)[/b]"elseif D >= 97 and D <= 99 then E="Mâchoire mutilée"F=5 G="Le coup arrache presque complètement la mâchoire, détruit la langue et envoie les dents à plusieurs mètres dans une pluie de sang. +4 États [i]Hémorragique[/i], +3 États [i]Sonné[/i]. Réussissez un Test de Résistance Très Difficile (-30) ou +1 État [i]Inconscient[/i]. Subissez le Traumatisme [b]Fracture (Majeure)[/b], la langue est perdue et 1D10 dents — [b]Amputation (Difficile)[/b]"elseif D==100 then E="Mort"F=666 G="La tête est tranchée au niveau du cou et part dans les airs, atterrissant à 1D3 mètres du corps dans une direction aléatoire (voir [b]Dispersion[/b]). La mort est instantanée, et le corps s'effondre sans vie."end elseif z == "Bras secondaire"or z == "Bras principal"then if D >= 1 and D <= 10 then E="Choc au bras"F=1 G= "Le bras "..z .. " de %s prend un choc au cours de l'attaque. %s lâche ce qu'il tenait."elseif D >= 11 and D <= 20 then E="Coupure mineure"F=1 G="%s saigne abondamment au niveau de l'avant-bras. +1 État [i]Hémorragique[/i]."elseif D >= 21 and D <= 25 then E="Torsion"F=1 G="%s se tord le bras, occasionnant +1 Traumatisme [i]Déchirure musculaire (Mineure)[/i]"elseif D >= 26 and D <= 30 then E="Choc violent au bras"F=2 G= "%s reçoit un coup particulièrement violent au "..z .. " et lâche ce qu'il avait dans la main, cette dernière restant inutilisable pendant 1D10 - Bonus d'Endurance Rounds (minimum 1). Pendant ce temps, considérez votre main comme perdue (voir Membres Amputés, p180)."elseif D >= 31 and D <= 35 then E="Déchirure musculaire"F=2 G= "Le coup écrase l'avant-bras du "..z .. " de %s. +1 État [i]Hémorragique[/i] et +1 Traumatisme [i]Déchirure musculaire (Mineure)[/i]."elseif D >= 36 and D <= 40 then E="Main ensanglantée"F=2 G= "La main du "..z .. " de %s est bien entaillée. Le sang rend la prise glissante avec cette main. +1 État [i]Hémorragique[/i]. Test de [i]Dextérité (Accessible)[/i] pour effectuer toute action avec un objet dans la main, sinon il échappe des mains."elseif D >= 41 and D <= 45 then E="Clef de bras"F=2 G= "L'articulation du "..z .. " de %s est pratiquement arrachée. La main correspondante lâche ce qu'elle tenait, le bras est inutilisable pendant 1D10 Rounds."elseif D >= 46 and D <= 50 then E="Blessure béante"F=3 G= "Le coup ouvre une blessure béante. +2 États [i]Hémorragique[/i]. Jusqu'à ce que %s soit soigné par Chirurgie afin de recoudre la blessure, tout nouveau Dégât au "..z .. " redonnera +1 État [i]Hémorragique[/i], la blessure s'étant réouverte."elseif D >= 51 and D <= 55 then E="Cassure nette"F=3 G= "Un craquement significatif se fait entendre au moment où le coup s'abat sur le "..z .. " de %s. La main correspondante lâche ce qu'elle tenait. +1 Traumatisme [i]Fracture (Mineure)[/i]. +1 État [i]Sonné[/i] en cas d'échec à un Test de [i]Résistance (Complexe)[/i]."elseif D >= 56 and D <= 60 then E="Ligament rompu"F=3 G= "%s lâche immédiatement ce qu'il tenait dans la main de son "..z .. ". +1 Traumatisme [i]Déchirure musculaire (Majeure)[/i]"elseif D >= 61 and D <= 65 then E="Coupure profonde"F=3 G= "+2 États [i]Hémorragique[/i] dûs à la forte mutilation du "..z .. " de %s. +1 État [i]Sonné[/i], +1 Traumatisme [i]Déchirure musculaire (Mineure)[/i], +1 État [i]Inconscient[/i] en cas d'échec à un Test de [i]Résistance (Difficile)[/i]."elseif D >= 66 and D <= 70 then E="Artère endommagée"F=4 G= "+4 États [i]Hémorragique[/i]. Jusqu'à ce que %s soit soigné par Chirurgie afin de recoudre la blessure, tout nouveau Dégât au "..z .. " redonnera +2 État [i]Hémorragique[/i], la blessure s'étant réouverte."elseif D >= 71 and D <= 75 then E="Coude fracassé"F=4 G= "Le coup fracasse le coude du "..z .. " de %s, faisant voler en éclats os et cartilage. %s lâche immédiatement ce qu'il tenait dans cette main, et subit +1 Traumatisme [i]Fracture (Majeure)[/i]"elseif D >= 76 and D <= 80 then E="Épaule luxée"F=4 G= "Le "..z .. " de %s est démis de son logement. %s lâche immédiatement ce qu'il tenait dans cette main. +1 État [i]Sonné[/i] et +1 État [i]À terre[/i] en cas d'échec à un Test de [i]Résistance (Difficile)[/i]. État [i]Sonné[/i] conservé jusqu'à bénéficier d'Aide Médicale. Un Test Étendu de Guérison avec 6 DR est nécessaire pour recouvrer l'usage du bras. Les tests utilisant ce bras subissent une pénalité de -10 pendant 1D10 jours."elseif D >= 81 and D <= 85 then E="Doigt sectionné"F=4 G="%s voit un de ses doigts s'envoler. +1 États [i]Hémorragique[/i]. — [b]Amputation (Accessible)[/b]."elseif D >= 86 and D <= 90 then E="Main ouverte"F=5 G= "La main du "..z .. " de %s s'ouvre sous la puissance du coup. Un Doigt est perdu — [b]Amputation (Complexe)[/b]. +2 États [i]Hémorragique[/i] et +1 État [i]Sonné[/i]. Pour chaque Round sans Aide Médicale, un autre Doigt est perdu. Si tous les doigts sont perdus, la main est perdue. — [b]Amputation (Complexe)[/b]"elseif D >= 91 and D <= 93 then E="Biceps déchiqueté"F=5 G= "Le coup sépare presque entièrement le biceps et le tendon de l'os du "..z .. " de %s, laissant une blessure effrayante dont le sang gicle jusque sur son adversaire. %s lâche immédiatement ce qu'il tenait dans cette main. +1 Traumatisme [i]Déchirure musculaire (Majeure)[/i], +2 États [i]Hémorragique[/i] et +1 État [i]Sonné[/i]"elseif D >= 94 and D <= 96 then E="Main mutilée"F=5 G= "La main du "..z .. " de %s n'est plus qu'un tas de chair hémorragique. La main est perdue — [b]Amputation (Difficile)[/b]. +2 États [i]Hémorragique[/i]. +1 État [i]Sonné[/i] et +1 État [i]À terre[/i] en cas d'échec à un Test de [i]Résistance (Difficile)[/i]"elseif D >= 97 and D <= 99 then E="Tendons coupés"F=5 G= "Les tendons sont sectionnés par la force du coup et le "..z .. " de %s est inutilisable — [b]Amputation (Difficile)[/b]. +3 États [i]Hémorragique[/i], +1 État [i]À terre[/i], +1 État [i]Sonné[/i]. +1 État [i]Inconscient[/i] en cas d'échec à un Test de [i]Résistance (Difficile)[/i]. "elseif D==100 then E="Démembrement fatal"F=666 G= "Le "..z .. " de %s est coupé, faisant gicler le sang des artères jusqu'à 1D3 mètres dans une direction aléatoire (voir [b]Dispersion[/b]). La mort de %s est instantanée, et son corps s'effondre sans vie."end elseif z=="Corps"then if D >= 1 and D <= 10 then E="Rien qu'une égratignure !"F=1 G="+1 État [i]Hémorragique[/i]."elseif D >= 11 and D <= 20 then E="Coup au ventre"F=1 G="+1 État [i]Sonné[/i]. +1 État [i]À terre[/i] et vomissement en cas d'échec à un Test de [i]Résistance (Facile)[/i]."elseif D >= 21 and D <= 25 then E="Coup bas"F=1 G="+3 États [i]Sonné[/i] en cas d'échec à un Test de [i]Résistance (Difficile)[/i]."elseif D >= 26 and D <= 30 then E="Torsion du dos"F=1 G="+1 Traumatisme [i]Déchirure musculaire (Mineure)[/i]"elseif D >= 31 and D <= 35 then E="Souffle coupé"F=2 G="+1 État [i]Sonné[/i]. +1 États [i]À terre[/i] en cas d'échec à un Test de [i]Résistance (Accessible)[/i]. Le mouvement de %s est réduit de moitié pendant 1D10 rounds, le temps de récupérer son souffle."elseif D >= 36 and D <= 40 then E="Bleus aux côtes"F=2 G="Tous les Tests basés sur l'Agilité sont effectués avec une pénalité de -10 pendant 1D10 jours."elseif D >= 41 and D <= 45 then E="Clavicule tordue"F=2 G="Choisissez un bras au hasard. La main correspondante lâche ce qu'elle tenait, et le bras reste inutilisable pendant 1D10 Rounds."elseif D >= 46 and D <= 50 then E="Chairs déchirées"F=2 G="+2 États [i]Hémorragique[/i]."elseif D >= 51 and D <= 55 then E="Côtes fracturées"F=3 G="Le coup fracture une ou plusieurs côtes. +1 État [i]Sonné[/i], +1 Traumatisme [i]Fracture (Mineure)[/i]."elseif D >= 56 and D <= 60 then E="Blessure béante"F=3 G= "+3 États [i]Hémorragique[/i]. Jusqu'à ce que %s soit soigné par Chirurgie afin de recoudre la blessure, tout nouveau Dégât au "..z .. " redonnera +1 État [i]Hémorragique[/i], la blessure s'étant réouverte."elseif D >= 61 and D <= 65 then E="Entaille douloureuse"F=3 G="+2 États [i]Hémorragique[/i] et +1 État [i]Sonné[/i]. +1 États [i]Inconscient[/i] en cas d'échec à un Test Spectaculaire de [i]Résistance (Difficile)[/i], %s s'évanouissant sous l'effet de la douleur. Avec moins de 4DR, %s hurle de douleur."elseif D >= 66 and D <= 70 then E="Dégâts artériels"F=3 G= "+4 États [i]Hémorragique[/i]. Jusqu'à ce que %s soit soigné par Chirurgie afin de recoudre la blessure, tout nouveau Dégât au "..z .. " redonnera +2 États [i]Hémorragique[/i], la blessure s'étant réouverte."elseif D >= 71 and D <= 75 then E="Dos froissé"F=4 G="Une douleur irradiante assaille %s lorsqu'il fait jouer les muscles de son dos. +1 Traumatisme [b]Déchirure musculaire (Majeure)[/b]"elseif D >= 76 and D <= 80 then E="Hanche fracturée"F=4 G="+1 État [i]Sonné[/i] et +1 Traumatisme [b]Fracture (Mineure)[/b]. +1 États [i]À terre[/i] en cas d'échec à un Test de [i]Résistance (Intermédiaire)[/i]."elseif D >= 81 and D <= 85 then E="Blessure majeure au torse"F=4 G="%s reçoit une blessure importante au torse, le coup arrache la peau, les muscles et les tendons. +4 États [i]Hémorragique[/i]. Jusqu'à ce que %s soit soigné par Chirurgie afin de recoudre la blessure, tout nouveau Dégât au torse redonnera +2 États [i]Hémorragique[/i], la blessure s'étant réouverte."elseif D >= 86 and D <= 90 then E="Blessure au ventre"F=4 G="+2 États [i]Hémorragique[/i], c'est une Blessure Purulente."elseif D >= 91 and D <= 93 then E="Cage thoracique perforée"F=5 G="+1 État [i]Sonné[/i] jusqu'à réception d'une Aide Médicale. +1 Traumatisme [b]Fracture (Majeure)[/b]."elseif D >= 94 and D <= 96 then E="Clavicule cassée"F=5 G="+1 État [i]Inconscient[/i] jusqu'à réception d'une Aide Médicale. +1 Traumatisme [b]Fracture (Majeure)[/b]."elseif D >= 97 and D <= 99 then E="Hémorragie interne"F=5 G="+1 État [i]Hémorragique[/i] jusqu'à réception d'une Chirurgie. %s contracte en outre une Infection Sanguine."elseif D==100 then E="Éventré"F=666 G="%s est littéralement coupé en deux, tout personnage situé à moins de 2 mètres est recouvert de sang."end elseif z == "Jambe gauche"or z == "Jambe droite"then E="Gluglu"F=0 G="GLUGLU"end return B,C,E,F,G end function w(z,A,B,C,D,E)z=string.lower(z)local F=""if z=="simple"then if B and C then local G= "Test Simple, difficulté "..m(C) .. ", maximum de " .. B local H= "["..'div class="yellow_d10" style="display: inline-table;text-align: center;vertical-align:middle;color: black;height: 24px;background-size: cover;width: 28px;text-shadow: -1px -1px 0px rgba(255, 227, 0, 0.3), 1px 1px 1px rgba(168, 129, 11, 0.8);"]' .. D .. "[" .. "/div]"H= H.."[" .. 'div class="white_d10" style="display: inline-table;text-align: center;vertical-align:middle;color: black;height: 24px;background-size: cover;width: 28px;text-shadow: -1px -1px 0px rgba(255, 227, 0, 0.3), 1px 1px 1px rgba(168, 129, 11, 0.8);"]' .. E .. "[" .. "/div]"local I=b(D,E)local J=h(I,B)local K=j(z,D,E)local L=""if J==true then L="Succès"else L="Échec"end local M=""if K==true then M="Critique"else M=""end local N=string.format("%d contre %d est un %s %s",I,B,L,M)local O=""if J and not K then O=string.format("L'action du personnage est [u]une réussite[/u].")elseif J and K then O=string.format("L'action du personnage est [u]une réussite stupéfiante !![/u]")elseif not J and not K then O=string.format("L'action du personnage est clairement [u]un échec[/u].")elseif not J and K then O=string.format("L'action du personnage est [u]un échec stupéfiant ![/u] Le personnage échoue lamentablement, tout est allé de travers et les conséquences de cet échec sont catastrophiques !")end return rpg.smf.save(G,H,N,O,"wfrp4")end elseif z=="spectaculaire"then if B and C then local G= "Test Spectaculaire, difficulté "..m(C) .. ", maximum de " .. B local H= '[div class="yellow_d10" style="display: inline-table;text-align: center;vertical-align:middle;color: black;height: 24px;background-size: cover;width: 28px;text-shadow: -1px -1px 0px rgba(255, 227, 0, 0.3), 1px 1px 1px rgba(168, 129, 11, 0.8);"]'..D .. "[/div]"H= H..'[div class="white_d10" style="display: inline-table;text-align: center;vertical-align:middle;color: black;height: 24px;background-size: cover;width: 28px;text-shadow: -1px -1px 0px rgba(255, 227, 0, 0.3), 1px 1px 1px rgba(168, 129, 11, 0.8);"]' .. E .. "[/div]"local I=b(D,E)local J=h(I,B)local K=j(z,D,E)local L=q(I,B)L= L+r(A)local M=""local N=""local O=""if J==true then if K then F=string.format("%d contre %d donne un Succès avec %d Degrés de Réussite, mais c'est surtout un jet Critique, obtenant ainsi un Succès Stupéfiant !",I,B,L)O="Grâce à ce jet de dés critique, l'action du personnage est un [u]Succès Stupéfiant[/u] ! Les résultats dépassent ce qu'il espérait, on n'aurait pas pu imaginer mieux !"else if L>=6 then F=string.format("%d contre %d donne un Succès avec %d Degrés de Réussite, ce qui est un [u]Succès Stupéfiant[/u] !",I,B,L)O="L'action du personnage est une [u]réussite stupéfiante[/u] ! Les résultats dépassent ce qu'il espérait, on n'aurait pas pu imaginer mieux !"elseif L == 4 or L == 5 then F=string.format("%d contre %d donne un Succès avec %d Degrés de Réussite, ce qui est un [u]Succès Impressionnant[/u] !",I,B,L)O="L'action du personnage est [u]réussie avec style[/u] et les résultats sont absolument parfaits."elseif L == 2 or L == 3 then F=string.format("%d contre %d donne un Succès avec %d Degrés de Réussite",I,B,L)O="L'action du personnage est [u]une réussite[/u]."elseif L == 0 or L == 1 then F=string.format("%d contre %d est un Succès mais avec %d Degré de Réussite, c'est un [u]Succès Minime[/u]...",I,B,L)O="L'action du personnage est [u]plus ou moins réussie[/u], mais ce n'est pas parfait et des effets inattendus sont possibles."end end elseif J==false then if K then F=string.format("%d contre %d donne un Échec avec %d Degrés de Réussite, mais c'est surtout un jet Critique, obtenant ainsi un Échec Stupéfiant !",I,B,L)O="L'action du personnage est [u]un Échec Stupéfiant ![/u] Le personnage échoue lamentablement, tout est allé de travers et les conséquences de cet échec sont catastrophiques !"else if L<=-6 then F=string.format("%d contre %d donne un Échec avec %d Degrés de Réussite, ce qui est un [u]Échec Stupéfiant[/u] !",I,B,L)O="L'action du personnage est [u]un Échec Stupéfiant ![/u] Le personnage échoue lamentablement, tout est allé de travers et les conséquences de cet échec sont catastrophiques !"elseif L == -4 or L == -5 then F=string.format("%d contre %d donne un Échec avec %d Degrés de Réussite, ce qui est un [u]Échec Impressionnant[/u] !",I,B,L)O="L'action du personnage est un [u]échec complet[/u], amenant même quelques conséquences collatérales négatives."elseif L == -2 or L == -3 then F=string.format("%d contre %d donne un Échec avec %d Degrés de Réussite.",I,B,L)O="L'action du personnage est clairement [u]un échec[/u]."elseif L == 0 or L == -1 then F=string.format("%d contre %d donne un Échec mais avec %d Degrés de Réussite, c'est un [u]Échec Minime[/u]...",I,B,L)O="L'action du personnage [u]échoue de peu[/u], avec peut-être des progrès mineurs ou la possibilité de retenter sa chance au prochain Round, si la situation s'y prête."end end end local P=F local Q=O return rpg.smf.save(G,H,P,Q,"wfrp4")end else return rpg.smf.save("Type de test inconnu","myrolls","myresults","myfooter","wfrp4")end end function x(z,A,B,C,D,E,F,G,H,I,J,K)local L=""local M= z or"Protagoniste 1"local N= F or"Protagoniste 2"L= L..'[div style="display: flex; color: white"]'L= L..'[div style="display: flex; flex-direction: column; width: 100%"]'L= L..'[span style="font-size: 1.2em; font-weight: bold; text-align: center; padding-bottom: 10px"]'L= L.."Test Opposé"L= L.."[/span]"L= L..'[div style="display: flex; width: 100%"]'L= L..'[div style="display: flex; flex-direction: column; flex-grow: 1; align-items: center"]'L= L..'[div style="display: flex; font-weight: bold"]'L= L..M L= L.."[/div]"L= L..'[div style="display: flex"]'L= L.."Seuil de base : " .. A L= L.."[/div]"L= L..'[div style="display: flex"]'L= L.."Difficulté " .. m(C) .. " (" .. n(C) .. ")"L= L.."[/div]"L= L..'[div style="display: flex"]'L= L.."Maximum : " .. B L= L.."[/div]"L= L.."[/div]"L= L..'[hr style="border: color; margin: 5px"]'L= L..'[div style="display: flex; flex-direction: column; flex-grow: 1; align-items: center"]'L= L..'[div style="display: flex; font-weight: bold"]'L= L..N L= L.."[/div]"L= L..'[div style="display: flex"]'L= L.."Seuil de base : " .. G L= L.."[/div]"L= L..'[div style="display: flex"]'L= L.."Difficulté " .. m(I) .. " (" .. n(I) .. ")"L= L.."[/div]"L= L..'[div style="display: flex"]'L= L.."Maximum : " .. H L= L.."[/div]"L= L.."[/div]"L= L.."[/div]"L= L.."[/div]"L= L.."[/div]"local O=""O= O..'[div style="display: flex"]'O= O..'[div style="display: flex; flex-grow: 1; justify-content: center"]'O= O..'[div class="yellow_d10" style="display: inline-table;text-align: center;vertical-align:middle;color: black;height: 24px;background-size: cover;width: 28px;text-shadow: -1px -1px 0px rgba(255, 227, 0, 0.3), 1px 1px 1px rgba(168, 129, 11, 0.8);"]'O= O..D O= O.."[/div]"O= O..'[div class="white_d10" style="display: inline-table;text-align: center;vertical-align:middle;color: black;height: 24px;background-size: cover;width: 28px;text-shadow: -1px -1px 0px rgba(255, 227, 0, 0.3), 1px 1px 1px rgba(168, 129, 11, 0.8);"]'O= O..E O= O.."[/div]"O= O.."[/div]"O= O..'[hr style="border: color; margin: 5px"]'O= O..'[div style="display: flex; flex-grow: 1; justify-content: center"]'O= O..'[div class="yellow_d10" style="display: inline-table;text-align: center;vertical-align:middle;color: black;height: 24px;background-size: cover;width: 28px;text-shadow: -1px -1px 0px rgba(255, 227, 0, 0.3), 1px 1px 1px rgba(168, 129, 11, 0.8);"]'O= O..J O= O.."[/div]"O= O..'[div class="white_d10" style="display: inline-table;text-align: center;vertical-align:middle;color: black;height: 24px;background-size: cover;width: 28px;text-shadow: -1px -1px 0px rgba(255, 227, 0, 0.3), 1px 1px 1px rgba(168, 129, 11, 0.8);"]'O= O..K O= O.."[/div]"O= O.."[/div]"O= O.."[/div]"local P=b(D,E)local Q=b(J,K)local R=h(P,B)local S=h(Q,H)local T=j("oppose",D,E)local U=j("oppose",J,K)local V=q(P,B)local W=q(Q,H)local X=""local Y=""local Z=""local ab=""local bb=""local cb=""local db=""local eb=""if T then bb="Critique"if(V >= 0 and V < 6)then V=6 elseif(V <= 0 and V > -6)then V=-6 end end if U then cb="Critique"if(W >= 0 and W < 6)then W=6 elseif(W <= 0 and W > -6)then W=-6 end end V= V+r(A)W= W+r(G)if R then X="Succès"else X="Échec"end if S then Y="Succès"else Y="Échec"end Z=string.format("%s %s[br/]avec [u]%d Degrés de Réussite[/u]",X,bb,V)ab=string.format("%s %s[br/]avec [u]%d Degrés de Réussite[/u]",Y,cb,W)local fb=""fb= fb..'[div style="display: flex"]'fb= fb..'[div style="display: flex; flex-grow: 1; justify-content: center"]'fb= fb..'[span class="" style="color: white"]'fb= fb..Z fb= fb.."[/span]"fb= fb.."[/div]"fb= fb..'[hr style="border: color; margin: 5px"]'fb= fb..'[div style="display: flex; flex-grow: 1; justify-content: center"]'fb= fb..'[span class="" style="color: white"]'fb= fb..ab fb= fb.."[/span]"fb= fb.."[/div]"fb= fb.."[/div]"local gb=""local hb=""local ib=""if(V > W and true)then ib=string.format("[u]%s remporte le Test[/u][br/]avec %d Degrés de Réussite d'écart.",M, V-W)gb=M hb=N elseif(V < W and true)then ib=string.format("[u]%s remporte le Test[/u][br/]avec %d Degrés de Réussite d'écart.",N, W-V)gb=N hb=M elseif(V == W and true)then if R and not S then ib=string.format("[u]%s remporte le Test[/u], départagé par le Succès du lancer",M)gb=M hb=N elseif S and not R then ib=string.format("[u]%s remporte le Test[/u], départagé par le Succès du lancer.",N)gb=N hb=M elseif(R and R)or(not R and not S)then if B>H then ib=string.format("[u]%s remporte le Test de peu[/u], départagé par le Seuil du Test.",M)gb=M hb=N elseif(B < H and true)then ib=string.format("[u]%s remporte le Test[/u], départagé par le Seuil du Test.",N)gb=N hb=M elseif(B == H and true)then if A>G then ib=string.format("[u]%s remporte le Test[/u], départagé par le Score de compétence.",M)gb=M hb=N elseif(A < G and true)then ib=string.format("[u]%s remporte le Test[/u], départagé par le Score de compétence.",N)gb=N hb=M elseif(A == G and true)then if(P < Q and true)then ib=string.format("[u]%s remporte le Test[/u], départagé par le Lancer de dé.",M)gb=M hb=N elseif(P > P and true)then ib=string.format("[u]%s remporte le Test[/u], départagé par le Lancer de dé.",N)gb=N hb=M elseif(P == Q and true)then ib=string.format("[u]Aucun protagoniste ne remporte le Test, c'est une égalité parfaite[/u].")end end end end end local jb=""if R and S then jb= jb..string.format( "Les deux protagonistes ont réussi, mais %s a tout de même pris le dessus sur %s.", gb, hb )elseif(R and not S)or(S and not R)then jb= jb..string.format("Le résultat est clair, sans ambigüité : %s a réussi et %s a échoué.", gb, hb)elseif not R and not S then jb= jb.."Toutefois, les deux protagonistes ont échoué, quel duel de bras cassés !"end local kb=""kb= kb..'[hr style="border: color; margin: 5px; "]'kb= kb..'[div style="display: flex;margin-top: 10px"]'kb= kb..'[div style="display: flex; flex-grow: 1; justify-content: center"]'kb= kb..'[div style="color: white"]'kb= kb..'[div style="color: white; font-size: 1.2em; font-weight: bold; padding-bottom:5px; line-height: 1.4em"]' .. ib .. "[/div]"kb= kb..'[div style="color: white; font-weight: bold; padding-top:5px"]' .. jb .. "[/div]"kb= kb.."[/div]"kb= kb.."[/div]"kb= kb.."[/div]"return rpg.smf.save(L,O,fb,kb,"wfrp4")end function y(z,A,B,C,D,E,F,G,H,I,J,K,L,M,N)local O=""local P= z or"Protagoniste 1"local Q= H or"Protagoniste 2"local R=""O= O..'[div style="display: flex; color: white"]'O= O..'[div style="display: flex; flex-direction: column; width: 100%"]'O= O..'[span style="font-size: 1.2em; font-weight: bold; text-align: center; padding-bottom: 10px"]'O= O.."Attaque au Corps-à-Corps"O= O.."[/span]"O= O..'[div style="display: flex; width: 100%"]'O= O..'[div style="display: flex; flex-direction: column; flex-grow: 1; align-items: center"]'O= O..'[div style="display: flex; font-weight: bold"]'O= O.."Attaquant"O= O.."[/div]"O= O..'[div style="display: flex; font-weight: bold"]'O= O..P O= O.."[/div]"O= O..'[div style="display: flex"]'O= O.."Seuil de base : " .. A O= O.."[/div]"O= O..'[div style="display: flex"]'O= O.."Difficulté " .. m(C) .. " (" .. n(C) .. ")"O= O.."[/div]"O= O..'[div style="display: flex"]'O= O..D .. " Avantages (" .. o(D) .. ")"O= O.."[/div]"O= O..'[div style="display: flex"]'O= O.."Seuil effectif : " .. B O= O.."[/div]"O= O.."[/div]"O= O..'[hr style="border: color; margin: 5px"]'O= O..'[div style="display: flex; flex-direction: column; flex-grow: 1; align-items: center"]'O= O..'[div style="display: flex; font-weight: bold"]'O= O.."Défenseur"O= O.."[/div]"O= O..'[div style="display: flex; font-weight: bold"]'O= O..Q O= O.."[/div]"O= O..'[div style="display: flex"]'O= O.."Seuil de base : " .. I O= O.."[/div]"O= O..'[div style="display: flex"]'O= O.."Difficulté " .. m(K) .. " (" .. n(K) .. ")"O= O.."[/div]"O= O..'[div style="display: flex"]'O= O..L .. " Avantages (" .. o(L) .. ")"O= O.."[/div]"O= O..'[div style="display: flex"]'O= O.."Seuil effectif : " .. J O= O.."[/div]"O= O.."[/div]"O= O.."[/div]"O= O.."[/div]"O= O.."[/div]"local S=""S= S..'[div style="display: flex"]'S= S..'[div style="display: flex; flex-grow: 1; justify-content: center"]'S= S..'[div class="yellow_d10" style="display: inline-table;text-align: center;vertical-align:middle;color: black;height: 24px;background-size: cover;width: 28px;text-shadow: -1px -1px 0px rgba(255, 227, 0, 0.3), 1px 1px 1px rgba(168, 129, 11, 0.8);"]'S= S..E S= S.."[/div]"S= S..'[div class="white_d10" style="display: inline-table;text-align: center;vertical-align:middle;color: black;height: 24px;background-size: cover;width: 28px;text-shadow: -1px -1px 0px rgba(255, 227, 0, 0.3), 1px 1px 1px rgba(168, 129, 11, 0.8);"]'S= S..F S= S.."[/div]"S= S.."[/div]"S= S..'[hr style="border: color; margin: 5px"]'S= S..'[div style="display: flex; flex-grow: 1; justify-content: center"]'S= S..'[div class="yellow_d10" style="display: inline-table;text-align: center;vertical-align:middle;color: black;height: 24px;background-size: cover;width: 28px;text-shadow: -1px -1px 0px rgba(255, 227, 0, 0.3), 1px 1px 1px rgba(168, 129, 11, 0.8);"]'S= S..M S= S.."[/div]"S= S..'[div class="white_d10" style="display: inline-table;text-align: center;vertical-align:middle;color: black;height: 24px;background-size: cover;width: 28px;text-shadow: -1px -1px 0px rgba(255, 227, 0, 0.3), 1px 1px 1px rgba(168, 129, 11, 0.8);"]'S= S..N S= S.."[/div]"S= S.."[/div]"S= S.."[/div]"local T=b(E,F)local U=b(M,N)local V=h(T,B)local W=h(U,J)local X=j("corps-a-corps",E,F)local Y=j("corps-a-corps",M,N)local Z=q(T,B)local ab=q(U,J)local bb=""local cb=""local db=""local eb=""local fb=""local gb=""local hb=""local ib=""local jb=""if X then db="Critique"end if Y then eb="Critique"end Z= Z+r(A)ab= ab+r(I)if V then bb="Succès"else bb="Échec"end if W then cb="Succès"else cb="Échec"end fb=string.format("%s %s[br/]avec [u]%d Degrés de Réussite[/u]",bb,db,Z)gb=string.format("%s %s[br/]avec [u]%d Degrés de Réussite[/u]",cb,eb,ab)local kb=""kb= kb..'[div style="display: flex"]'kb= kb..'[div style="display: flex; flex-grow: 1; justify-content: center"]'kb= kb..'[span class="" style="color: white"]'kb= kb..fb kb= kb.."[/span]"kb= kb.."[/div]"kb= kb..'[hr style="border: color; margin: 5px"]'kb= kb..'[div style="display: flex; flex-grow: 1; justify-content: center"]'kb= kb..'[span class="" style="color: white"]'kb= kb..gb kb= kb.."[/span]"kb= kb.."[/div]"kb= kb.."[/div]"local lb=""local mb=""local nb=""local ob=""local pb=""local qb=""local rb=0 local sb=0 local tb=""local ub=""local vb=0 local wb=0 local xb=0 local yb=0 if X then nb=s(rpg.roll.dice(1,1,100)[1])pb=v(nb)vb,wb,pb,rb,tb=v(nb)else nb=s(T)pb=t(nb)end if Y then ob=s(rpg.roll.dice(1,1,100)[1])xb,yb,qb,sb,ub=v(ob)end if(V and X)then ib= ib..string.format( "[u]%s porte un Coup Critique[/u] touchant %s avec pour effet [b]%s[/b]. Le coup outrepasse l'armure éventuelle, et occasionne directement %d Dégâts, avec des effets supplémentaires : %s", P, Q, pb, rb, tb )end if(W and Y)then jb= jb..string.format( "[u]En se défendant de l'attaque de %s, %s réussit un Coup Critique[/u] avec pour effet [b]%s[/b]. Le coup outrepasse l'armure éventuelle, et occasionne directement %d Dégâts, avec des effets supplémentaires : %s", P, Q, qb, sb, ub )end hb= ib.."[br/]" .. jb .. "[br/]"if(Z > ab and true)then hb= hb..string.format( "[u]%s attaque avec succès[/u] et touche %s %s. Il occasionne des Dégâts à hauteur de %d DR + %d ", P, Q, pb, Z - ab, G )lb=P mb=Q elseif(Z < ab and true)then hb= hb..string.format( "[u]%s remporte le Test[/u][br/]avec %d Degrés de Réussite d'écart.", Q, ab - Z )lb=Q mb=P elseif(Z == ab and true)then if V and not W then hb= hb..string.format("[u]%s remporte le Test[/u], départagé par le Succès du lancer", P)lb=P mb=Q elseif W and not V then hb= hb..string.format("[u]%s remporte le Test[/u], départagé par le Succès du lancer.", Q)lb=Q mb=P elseif(V and V)or(not V and not W)then if(B > J and true)then hb= hb..string.format( "[u]%s remporte le Test de peu[/u], départagé par le Seuil du Test.", P )lb=P mb=Q elseif(B < J and true)then hb= hb..string.format("[u]%s remporte le Test[/u], départagé par le Seuil du Test.", Q)lb=Q mb=P elseif(B == J and true)then if A>I then hb= hb..string.format( "[u]%s remporte le Test[/u], départagé par le Score de compétence.", P )lb=P mb=Q elseif(A < I and true)then hb= hb..string.format( "[u]%s remporte le Test[/u], départagé par le Score de compétence.", Q )lb=Q mb=P elseif(A == I and true)then if(T < U and true)then hb= hb..string.format( "[u]%s remporte le Test[/u], départagé par le Lancer de dé.", P )lb=P mb=Q elseif(T > U and true)then hb= hb..string.format( "[u]%s remporte le Test[/u], départagé par le Lancer de dé.", Q )lb=Q mb=P elseif(T == U and true)then hb= hb..string.format("[u]Aucun protagoniste ne remporte le Test, c'est une égalité parfaite[/u].")end end end end end local zb=""if V and W then zb= zb..string.format( "Les deux protagonistes ont réussi, mais %s a tout de même pris le dessus sur %s.", lb, mb )elseif(V and not W)or(W and not V)then zb= zb..string.format("Le résultat est clair, sans ambigüité : %s a réussi et %s a échoué.", lb, mb)elseif not V and not W then zb= zb.."Toutefois, les deux protagonistes ont échoué, quel duel de bras cassés !"end local Ab=""Ab= Ab..'[hr style="border: color; margin: 5px; "]'Ab= Ab..'[div style="display: flex;margin-top: 10px"]'Ab= Ab..'[div style="display: flex; flex-grow: 1; justify-content: center"]'Ab= Ab..'[div style="color: white"]'Ab= Ab..'[div style="color: white; font-size: 1.2em; font-weight: bold; padding-bottom:5px; line-height: 1.4em"]' .. hb .. "[/div]"Ab= Ab..'[div style="color: white; font-weight: bold; padding-top:5px"]' .. zb .. "[/div]"Ab= Ab.."[/div]"Ab= Ab.."[/div]"Ab= Ab.."[/div]"return rpg.smf.save(O,S,kb,Ab,"wfrp4")end function rpg.accel.test(z)local A,B=rpg.smf.striptitle(z)local C=string.match(z,"([%w%p]*)[%s]*")C= tostring(C)or""if((C == "simple" or C == "spectaculaire")and true)then local D,E=string.match(z,"%w*[%s]*(%d*)[%s]*(%w*)[%s]*")D= tonumber(D)or nil E=l(tostring(E)or"")local F=k(E)local G=p(D,F)local H=rpg.roll.dice(2,0,9)local I=H[1]local J=H[2]local K=h(b(I,J),G)local L=i(b(I,J),G)local M=j(C,I,J)return w(C,D,G,E,I,J)elseif(C == "oppose"and true)then local D,E,F,G,H,I=string.match(z,"%w*[%s]+([%w%p]*)[%s]+(%d+)[%s]+([%w]*)[%s]*/[%s]*([%w%p]+)[%s]*(%d+)[%s]*([%w]*)")E= tonumber(E)or nil H= tonumber(H)or nil if(F == ""and true)then F="I"end if(I == ""and true)then I="I"end F=l(F)I=l(I)local J=k(F)local K=k(I)local L=p(E,J)local M=p(H,K)local N=rpg.roll.dice(2,0,9)local O=rpg.roll.dice(2,0,9)local P=N[1]local Q=O[1]local R=N[2]local S=O[2]local T=h(b(P,R),L)local U=h(b(Q,S),M)local V=i(b(P,R),L)local W=i(b(Q,S),M)local X=j(C,P,R)local Y=j(C,Q,S)return x(D,E,L,F,P,R,G,H,M,I,Q,S)elseif(C == "corps-a-corps"and true)then local D,E,F,G,H=string.match(z,"%w*[%s]+([%w%p]*)[%s]+(%d+)[%s]+([%w]*)[%s]*(%d*)A[%s]*(%d*)BF[%s]*.*/.*")local I=string.match(z,".*Enroulement.*/")I= I~=nil local J=string.match(z,".*(Poudre).*/")J= J~=nil local K=string.match(z,".*(Assommante).*/")K= K~=nil print("atoutAssommante",K)local L=string.match(z,".*(Défensive).*/")L= L~=nil print("atoutDefensive",L)local M=string.match(z,".*(Dévastatrice).*/")M= M~=nil print("atoutDevastatrice",M)local N=string.match(z,".*(Empaleuse).*/")N= N~=nil print("atoutEmpaleuse",N)local O=string.match(z,".*Explosion.*/")O= O~=nil print("atoutExplosion",O)local P=string.match(z,".*Explosion(%d*).*/")print("indiceAtoutExplosion",P)local Q=string.match(z,".*(Immobilisante).*/")Q= Q~=nil print("atoutImmobilisante",Q)local R=string.match(z,".*(Incassable).*/")R= R~=nil print("atoutIncassable",R)local S=string.match(z,".*(Percutante).*/")S= S~=nil print("atoutPercutante",S)local T=string.match(z,".*(Perforante).*/")T= T~=nil print("atoutPerforante",T)local U=string.match(z,".*(Perturbante).*/")U= U~=nil print("atoutPerturbante",U)local V=string.match(z,".*(Piège-lame).*/")V= V~=nil print("atoutPiegeLame",V)local W=string.match(z,".*(Pistolet).*/")W= W~=nil print("atoutPistolet",W)local X=string.match(z,".*(Pointue).*/")X= X~=nil print("atoutPointue",X)local Y=string.match(z,".*(Précise).*/")Y= Y~=nil print("atoutPrecise",Y)local Z=string.match(z,".*Protectrice.*/")Z= Z~=nil print("atoutProtectrice",Z)local ab=string.match(z,".*Protectrice(%d*).*/")print("atoutProtectrice(%d)",ab)local bb=string.match(z,".*(Rapide).*/")bb= bb~=nil print("atoutRapide",bb)local cb=string.match(z,".*(Taille).*/")cb= cb~=nil print("atoutTaille",cb)local db,eb,fb,gb=string.match(z,".*/[%s]*([%w%p]+)[%s]*(%d+)[%s]*([%w]*)[%s]*(%d*)A[%s]*")E= tonumber(E)or nil eb= tonumber(eb)or nil G= tonumber(G)or 0 gb= tonumber(gb)or 0 H= tonumber(H)or 0 print("TestCorpsACorps:avantage1",G)print("TestCorpsACorps:avantage2",gb)print("TestCorpsACorps:bonusForce1",H)if(F == ""and true)then F="I"end if(fb == ""and true)then fb="I"end F=l(F)fb=l(fb)local hb=k(F)local ib=k(fb)local jb=p(E,hb)local kb=p(eb,ib)jb= jb+(G * 10)kb= kb+(gb * 10)local lb=rpg.roll.dice(2,0,9)local mb=rpg.roll.dice(2,0,9)local nb=lb[1]local ob=mb[1]local pb=lb[2]local qb=mb[2]local rb=h(b(nb,pb),jb)local sb=h(b(ob,qb),kb)local tb=i(b(nb,pb),jb)local ub=i(b(ob,qb),kb)local vb=j(C,nb,pb)local wb=j(C,ob,qb)return y(D,E,jb,F,G,nb,pb,H,db,eb,kb,fb,gb,ob,qb)elseif(C == "distance"and true)then print("Test d'Attaque à distance:",C)else print("Test de type inconnu:",C)end end